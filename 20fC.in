
Eo = 0 ; 			# Energy [eV]
G=1-qe*Eo/(me*c*c) ;
initrad= 12.74*1e-6;
Qtot= -0.02*1e-12;
temit= 4.*1e-12;
numpart=65536.;
accuracy(6) ;

setparticles("beam",numpart,me,qe,Qtot);
setrxydist("beam","g",0,initrad,0,3.);
setphidist("beam","u",0,2*pi);
settdist("beam","u",0,temit);

GBr = 10e-3 ;
setGBrxydist("beam","u",GBr/2,GBr) ;
setGBphidist("beam","u",0,2*pi) ;
setGBxemittance("beam",(0.45*initrad)/1e3) ;
setGByemittance("beam",(0.45*initrad)/1e3) ;

spacecharge3Dmesh("Cathode","Boundaries","AAAAAA");
snapshot(0);
zminmax("wcs","I", -1, 100.) ;

#########    Gun Cavity    ###########
crest = 136 ;
offset = -8.86; ;
phi = pi * (crest + offset)/180 ;
freq = 2998e6 ;
ffac =  63.*1e6 ; 			# Nominal field strength
w    = 2*pi*freq ;
map1D_TM("wcs", "z", 0, "MAPS/2.5cellgun.gdf", "z", "E", ffac, phi, w);

######### 4HC Cavity ###########
f = 11994000000.;
w00 = 2*pi*f;
phi00 = -4.58/deg;
ffac00 = 4450000.;
map1D_TM("wcs", "z", 0.14, "MAPS/4cell_DCPx.gdf", "z", "Ez", ffac00, phi00, w00);

######### Dechirper Cavity ###########
f = 2998500000.;
w00 = 2*pi*f;
phi00 = -116.5/deg;
ffac00 = 27130000.;
map1D_TM("wcs", "z", 0.52, "MAPS/3cell_DCP.gdf", "z","Ez", ffac00, phi00, w00);
map1D_B("wcs", "z", 0.32, "MAPS/10cm_sol_map.gdf", "z","Bz", 0.0039);
map1D_B("wcs", "z", 0.67, "MAPS/10cm_sol_map.gdf", "z","Bz", 0.201);
map1D_B("wcs", "z", 0.92, "MAPS/ob_lens.gdf", "z","Bz", 1.5);

screen("wcs", "I", 0.14);
screen("wcs", "I", 0.52);
screen("wcs", "I", 0.90181);
screen("wcs", "I", 0.93819);
screen("wcs", "I", 0., 1.02, 0.01);
screen("wcs", "I", 0.88362, 0.93819, 0.001);
